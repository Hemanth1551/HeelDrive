<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="ss1.css">
	<script src="https://unpkg.com/phosphor-icons"></script>
	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
	

	<title>User Profile Tab</title>
</head>
<body>
	<div class="app">
		<header class="app-header">
			<div class="app-header-logo">
				<div class="logo">
					<span class="logo-icon">
						<img src="/images/logo.png" />
					</span>
					<h1 class="logo-title">
						<span>Heel_Drive</span>
						<span>Shoes</span>
					</h1>
				</div>
			</div>
			<div class="app-header-navigation">
				<div class="tabs">
					<a href="userproducts.html">
						Products
					</a>
					<a href="useraddress.html">
						Address
					</a>
					<a href="userorder.html">
						Orders
					</a>
					<a href="usercart.html">
						Cart
					</a>
					<a href="userprofile.html" class="active">
						Your Profile
					</a>
				</div>
			</div>
			
			<div id="mapDiv" style="
            align-items: center;
            text-align: center;
            display: none; position: absolute; background-color: rgb(50, 50, 50); height: 300px; width: 400px; top: 150px; right: 0; z-index: 2;">
                <div class="tabs" style="display: block;">
					<a href="userproducts.html" class="active">
						Products
					</a><br>
					<a href="useraddress.html">
						Address
					</a><br>
					<a href="userorder.html">
						Orders
					</a><br>
					<a href="usercart.html">
						Cart
					</a><br>
					<a href="userprofile.html">
						Your Profile
					</a>
				</div>
            </div>
            
            <div id="mapDiv" style="
            align-items: center;
            text-align: center;
            display: none; position: absolute; background-color: rgb(50, 50, 50); height: 300px; width: 400px; top: 150px; right: 0; z-index: 2;">
                <div class="tabs" style="display: block;">
					<a href="userproducts.html" class="active">
						Products
					</a><br>
					<a href="useraddress.html">
						Address
					</a><br>
					<a href="userorder.html">
						Orders
					</a><br>
					<a href="usercart.html">
						Cart
					</a><br>
					<a href="userprofile.html">
						Your Profile
					</a>
				</div>
            </div>
            
			<div class="app-header-actions">
				<button class="user-profile">
					<span id="usname"></span>
					<span>
						<img src="" id="usprofile"/>
					</span>
				</button>
				<div class="app-header-actions-buttons">
				</div>
			</div>
			<div class="app-header-mobile">
				<button class="icon-button large" onclick="showmap()">
					<i class="ph-list"></i>
				</button>
			</div>
	
		</header>
		<div class="app-body">
			<div class="app-body-navigation">
				<nav class="navigation">
					<a href="userproducts.html">
						<i class="ph-browsers"></i>
						<span>Products</span>
					</a>
					<a href="useraddress.html">
						<i class="ph ph-house"></i>
						<span>Address</span>
					</a>
					<a href="usercart.html">
						<i class="ph ph-credit-card"></i>
						<span>Cart</span>
					</a>
					<a href="userorder.html">
						<i class="ph ph-user"></i>
						<span>Orders</span>
					</a>
					<a href="userprofile.html">
						<i class="ph ph-bag"></i>
						<span>Your Profile</span>
					</a>
					<a href="userlogout.html">
						<i class="ph ph-package"></i>
						<span>Logout</span>
					</a>
				</nav>
				<footer class="footer">
					<h1>Heel Drive<small>©</small></h1>
					<div>
						Heel Drive ©<br />
						All Rights Reserved 2025
					</div>
				</footer>
			</div>
			<div class="app-body-main-content">
                <section class="service-section">
                    <div class="transfer-section-header">
                        <h2>User Details</h2>
                        <div class="filter-options">
                            <p>Filter selected: more than 100 $</p>
                            <button class="icon-button" title="Logout" onclick="logout()">
                                <i class="ph ph-sign-out"></i>
                            </button>
                            <button class="icon-button">
                                <i class="ph-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="tiles">
                        <article style="height: 260px; max-width: 800px;" id="addressblock">
                            

                            
                                <div class="userdata">
                                    <div class="ll">
                                        <div class="userone" style="margin-right: 50px; margin-left: 50px;">
                                            <span class="Email">Admin Name : </span> <input type="text" id="usernamee" class="user-search" placeholder="Admin Name" style="width: 250px; margin-top: 10px;"><br>
                                            <span class="Email">Email Id : </span> <input type="text" id="useremail" class="user-search" placeholder="Email Id" style="width: 250px; margin-top: 10px;"><br>
                                            <span class="password">Password : </span> <input type="text" id="userpass" class="user-search" placeholder="Password" style="width: 250px; margin-top: 10px;"> <br>
                                        </div>
                                        <div class="usertwo" style="margin-left: 50px;">
                                            <span class="MonileNo">Mobile No : <input type="text" id="usermobile" class="user-search" placeholder="Mobile No" style="width: 250px; margin-top: 10px;"> <br>
                                            <span class="created">Account Created : </span> <input type="text" id="usercreated" readonly class="user-search" style="width: 250px; margin-top: 10px;"> <br>
                                            <span class="updated">Last Acount Updated : </span> <input type="text" id="userupdate" readonly class="user-search" style="width: 250px; margin-top: 10px;"> <br>
                                        </div>
                                    </div>
                                    <div class="userthree">
                                        <img src="" alt="Admin photo" id="userimgg" style="width: 250px; height: 250px; max-width: 500%; margin-left:50px;">
                                    </div>
                                </div>
                        
                            
                        </article>
                    </div>
                </section>
            </div>
			<div class="app-body-sidebar">
			</div>
		</div>
	</div>
	
	<script>
	
	let userdata = {};
	let filteruser = {};

	async function fetchUserInfo() {
	  try {
		  const [userRes, usersRes] = await Promise.all([
		      fetch('/api/userinfo'),
		      fetch('/api/users')  // Replace with your actual second endpoint
		    ]);

	    if (!userRes.ok) {
	      throw new Error('Failed to fetch user info');
	    }

	    const data = await userRes.json();
	    userdata = await usersRes.json();
	    
	 // Update DOM
	      document.getElementById("usname").innerText = data.name;
	      document.getElementById("usprofile").src = `/api/getUserImage/${data.id}`;
	    
	    
	    filteruser = userdata.filter(add => 
	    	add?.id !== undefined && add?.id !== null && 
	    	add.id.toString() === data.id.toString()
		);

	        
	    userprint(filteruser);
	    //admindatafun();

	  } catch (error) {
	    console.error('Error fetching admin data:', error.message);
	  }
	}

	  // Call function on load
	  //fetchUserInfo();
	
	 // console.log("User Data:", data);
	
	  
	  
	  
	  
	  window.addEventListener('DOMContentLoaded', () => {
			fetch('/api/userinfo')
		    .then(res => {
		      if (res.ok) return res.json();
		      else throw new Error('Not User');
		    })
		    .then(user => {
		      // User is logged in
		      console.log("Logged in as User:", user.name);
		      fetchUserInfo();

		      //window.location.href = `/usersingleproduct.html?id=${loc}`;
		    })
		    .catch(() => {
		      // Neither admin nor user logged in
		      alert("Not logged in. Redirecting to login page.");
		      window.location.href = '/userlogin.html';
		    });
		});

	  function userprint(filteradmin){
			
		    console.log(" Data:", filteradmin[0].id);

			document.getElementById("usernamee").value = filteradmin[0].username;
			document.getElementById("useremail").value = filteradmin[0].email;
			document.getElementById("userpass").value = filteradmin[0].password;
			document.getElementById("usermobile").value = filteradmin[0].phone;
			document.getElementById("usercreated").value = filteradmin[0].created;
			document.getElementById("userupdate").value = filteradmin[0].updateat;
		    document.getElementById("userimgg").src = `/api/getUserImage/${filteradmin[0].id}`;
		    

		}
	  
	  
	  function logout() {
		  fetch('/api/logout', {
		    method: 'POST',
		    credentials: 'include'  // Important to send session cookie
		  })
		    .then(res => {
		      if (res.ok) return res.text();
		      else throw new Error('Logout failed');
		    })
		    .then(() => {
		      window.location.href = '/userlogin.html';
		    })
		    .catch(() => {
		      alert("Not logged in. Redirecting to login page.");
		      window.location.href = '/userlogin.html';
		    });
		}
	  
	  
	  
	  function updateUserField(field, value) {
			
			const userId = filteruser[0].id;
			function getTodayDate() {
				  return new Date().toISOString().split("T")[0];
			}
			
			const payload = {
				    [field]: value,
				    updateat: getTodayDate()  // Always add "updated" field
				  };
			
			fetch(`/api/user/${userId}`, {
			    method: 'PUT',
			    headers: {
			      'Content-Type': 'application/json'
			    },
			    body: JSON.stringify(payload)
			  })
			  .then(response => {
			    if (!response.ok) throw new Error("Failed to update user");
			    return response.json();
			  })
			  .then(data => {
			    console.log(`Updated ${field}:`, data);
			  })
			  .catch(error => {
			    console.error(`Error updating ${field}:`, error);
			  });
			}

	  
	  
	  
	//details updating Attach listeners
	  document.getElementById("usernamee").addEventListener("blur", function () {
	    updateUserField("username", this.value);
	  });

	  document.getElementById("useremail").addEventListener("blur", function () {
		  updateUserField("email", this.value);
	  });

	  document.getElementById("userpass").addEventListener("blur", function () {
		  updateUserField("password", this.value);
	  });

	  document.getElementById("usermobile").addEventListener("blur", function () {
		  updateUserField("phone", this.value);
	  });
	  
	  
	  function showmap() {
          const mapDiv = document.getElementById("mapDiv");
          if (mapDiv.style.display === "none" || mapDiv.style.display === "") {
              mapDiv.style.display = "block";
          } else {
              mapDiv.style.display = "none";
          }
      }
	</script>
	
</body>
</html>

<style>

@media (min-width: 320px) and (max-width: 426px){



    .tiles{
        background-color: #1f1f1f;
        margin-left: -18px;
    }
    .userdata{
        display: block;
        background-color: #1f1f1f;
        width: 405px;
        /* margin-left: -10px; */
        
    }
    .ll{
        display: block;
        /* background-color: red; */

    }
}




/* tab */
@media (min-width: 426px) and (max-width: 768px){
	.tiles article{
		width: 300px;
	}

    .tiles{
        background-color: #1f1f1f;
        margin-left: -30px;
    }
    .userdata{
        display: flex;
        background-color: #1f1f1f;
        width: 730px;
        /* margin-left: -10px; */
        
    }
    /* .userdata{
        display: flex;
    } */
}
/* small laptop */
@media (min-width: 769px) and (max-width: 1024px){ 
	
	.tiles article{
		width: 300px;
	  /* background: red; */
	}
    .ll{
        display: flex;
    }
    .userdata{
        display: flex;
    }

}
@media (min-width: 1025px) and (max-width: 1600px){ 
	.userdata{
        display: flex;
    }
     .ll{
        display: flex;
    }
    .userdata{
        display: flex;
    
	
	.tiles{
		width: 1070px;
	}
    }


    /* Green transition for .button */
    .button::before {
        background: rgb(34, 197, 94);
    }

    /* Blue transition for .button1 */
    .button1::before {
        background: rgb(0, 102, 255);
    }

    /* Expand effect on hover */
    .button:hover::before, .button1:hover::before {
        width: 100%;
    }

    .button:hover, .button1:hover {
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        color: white;
    }
}


</style>