<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="ss1.css">
    <link rel="stylesheet" href="sicss.css">
	<script src="https://unpkg.com/phosphor-icons"></script>
    <script src="https://kit.fontawesome.com/179f43bc7a.js" crossorigin="anonymous"></script>
	<title>Admin Product Tab</title>
</head>
<body>
	<div class="app">
		<header class="app-header">
			<div class="app-header-logo">
				<div class="logo">
					<span class="logo-icon">
						<img src="/images/logo.png" />
					</span>
					<h1 class="logo-title">
						<span>Heel_Drive</span>
						<span>Shoes</span>
					</h1>
				</div>
			</div>
			<div class="app-header-navigation">
				<div class="tabs">

					<a href="address.html">
						Addess
					</a>
					<a href="card.html">
						Cards
					</a>
					<a href="users.html" class="active">
						Users
					</a>
					<a href="order.html">
						Orders
					</a>
					<a href="product.html">
						Products
					</a>
				</div>
			</div>
			<div class="app-header-actions">
				<button class="user-profile">
					<span id="adminname"></span>
					<span>
						<img src="" id="adminimg"/>
					</span>
				</button>
				<div class="app-header-actions-buttons">
				</div>
			</div>
			<div class="app-header-mobile">
				<button class="icon-button large">
					<i class="ph-list"></i>
				</button>
			</div>
		</header>
		<div class="app-body">
			<div class="app-body-navigation">
				<nav class="navigation">
					<a href="Dashboard.html">
						<i class="ph-browsers"></i>
						<span>Dashboard</span>
					</a>
					<a href="address.html">
						<i class="ph ph-house"></i>
						<span>Addess</span>
					</a>
					<a href="card.html">
						<i class="ph ph-credit-card"></i>
						<span>Cards</span>
					</a>
					<a href="users.html">
						<i class="ph ph-user"></i>
						<span>Users</span>
					</a>
					<a href="order.html">
						<i class="ph ph-bag"></i>
						<span>Orders</span>
					</a>
					<a href="product.html">
						<i class="ph ph-package"></i>
						<span>Products</span>
					</a>
					<a href="payment.html">
						<i class="ph ph-currency-inr"></i>
						<span>Payments</span>
					</a>
					<a href="profile.html">
						<i class="ph ph-user-circle"></i>
						<span>Profile</span>
					</a>
				</nav>
				<footer class="footer">
					<h1>Heel Drive<small>©</small></h1>
					<div>
						Heel Drive ©<br />
						All Rights Reserved 2025
					</div>
				</footer>
			</div>
			<div class="app-body-main-content">
				<section class="service-section">
					<h2>User Data</h2>
					<div class="service-section-header">
					</div>
					<div class="mobile-only">
						<button class="flat-button">
							Toggle search
						</button>
					</div>
                    <div class="card-wapper">
                        <div class="card1">
                            <div class="product-img">
                                <div class="img-display">
                                    <div class="img-showcase" style="height: 350px;">
                                        <img src="" id="profile" alt="shoe" style="height: 200px; width: 200px; min-width: 0; background-size: cover; margin-top:150px; margin-left:150px; ">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="product-content">
                                <input class="product-tittle" id="username" style="width: 300px;">
                                <div class="product-ratting">
									<p class="last-price">User Id: <input id="userid" readonly style="color: #256eff; text-decoration: none; border: none;"></p>
                                </div>
                                <div class="product-price">
                                    <p class="last-price">Email: <input id="mail" style="color: #256eff; text-decoration: none; border: none; width:230px;"></p>
                                    <p class="new-price">Password: <input id="pass" style="border: none; color: #256eff;"></p>
                                    <p class="last-price">Mobile No: <input id="mob" style="color: #256eff; text-decoration: none; border: none;"></p>
                                    <p class="new-price">Created: <input id="cre" readonly style="border: none; color: #256eff;"></p>
                                    <p class="new-price">Last Updated: <input id="lastup" readonly style="border: none; color: #256eff;"></p>
                                </div>
                               
                                <div class="purchase-info" style="color: black;">
                                	<p>You Can Update all values by Here you will change automatically updation applyed.</p>
                                </div>
                            </div>
                            <div class="addresss">
                                <div class="product-detail" style="overflow-x: scroll; width: 500px;">
                                    
                                </div>
                            </div>
                        </div>
					<div class="faq">
					</div>
					<div class="payment-section-footer">
					</div>
				</section>
			</div>
			<div class="app-body-sidebar">
			</div>   
		</div>
	</div>
	
	<script>
	
	// Get the full query string from the URL
	const queryString = window.location.search;

	// Create a URLSearchParams object
	const urlParams = new URLSearchParams(queryString);

	// Get the value of the "id" parameter	
	let userId = urlParams.get('id');
	
	
	if (userId) {
        fetch(`/api/getUsers/${userId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error: ${response.status} - ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("Fetched product data:", data);
                
                
                var username = document.getElementById("username"); // Ensure the element exists
                var userid = document.getElementById("userid");
                var useremail = document.getElementById("mail");
                var userpass = document.getElementById("pass");
                var usermob = document.getElementById("mob");
                var usercre = document.getElementById("cre");
                var userlast = document.getElementById("lastup");
                var userprofile = document.getElementById("profile");



                

                userprofile.src = `/api/getUserImage/${userId}`;
           
                
                
                username.value = data.username || "N/A"; // Use `color`, not `colour`
                userid.value = data.id || "N/A";
                useremail.value = data.email || "N/A";
                userpass.value = data.password || "N/A";
                usermob.value = data.phone || "N/A";
                
                usercre.value = data.created || "N/A"; // Use `color`, not `colour`
                userlast.value = data.updateat || "N/A";
                
               
                
                
            })
            .catch(error => console.error("Error fetching product:", error));
    }   
	
	
    let admindata = {};

	  async function fetchAdminInfo() {
	    try {
	      const adminRes = await fetch('/api/admininfo');

	      if (!adminRes.ok) {
	        throw new Error('Failed to fetch admin info');
	      }

	      const data = await adminRes.json();

	      
	      // Update DOM
	      document.getElementById("adminname").innerText = data.name;
	      document.getElementById("adminimg").src = `/api/getAdminImage/${data.id}`;

	      console.log("Admin Data:", data);

	    } catch (error) {
	      console.error('Error fetching admin data:', error.message);
	    }
	  }

	  // Call function on load
	  fetchAdminInfo();
	  
	  
	  
	//Attach listeners
	  document.getElementById("username").addEventListener("blur", function () {
	    updateAdminField("username", this.value);
	  });

	  document.getElementById("mail").addEventListener("blur", function () {
	    updateAdminField("email", this.value);
	  });

	  document.getElementById("mob").addEventListener("blur", function () {
		    updateAdminField("phone", this.value);
	 });
	  
	 document.getElementById("pass").addEventListener("blur", function () {
	    updateAdminField("password", this.value);
	 });

	 function updateAdminField(field, value) {
			
			const adminId = userId;
			function getTodayDate() {
				  return new Date().toISOString().split("T")[0];
			}
			
			const payload = {
				    [field]: value,
				    updateat: getTodayDate()  // Always add "updated" field
				  };
			
			fetch(`/api/user/${userId}`, {
			    method: 'PUT',
			    headers: {
			      'Content-Type': 'application/json'
			    },
			    body: JSON.stringify(payload)
			  })
			  .then(response => {
			    if (!response.ok) throw new Error("Failed to update admin");
			    return response.json();
			  })
			  .then(data => {
			    console.log(`Updated ${field}:`, data);
			  })
			  .catch(error => {
			    console.error(`Error updating ${field}:`, error);
			  });
			}
	
	</script>
	
</body>
</html>

<style>
    @media (max-width: 426px) {
        .product-detail {
            width: 400px;
        }
    }
</style>